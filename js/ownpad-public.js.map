{"version":3,"file":"ownpad-public.js?v=6e80197c2e5dbbba8bbf","mappings":"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","sources":["webpack:///ownpad/node_modules/@nextcloud/router/dist/index.js","webpack:///ownpad/webpack/bootstrap","webpack:///ownpad/src/utils/isPublicPage.js","webpack:///ownpad/src/utils/isOwnpad.js","webpack:///ownpad/src/public.js"],"sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.linkTo = exports.imagePath = exports.getRootUrl = exports.generateUrl = exports.generateRemoteUrl = exports.generateOcsUrl = exports.generateFilePath = void 0;\n/**\n * Get an url with webroot to a file in an app\n *\n * @param {string} app the id of the app the file belongs to\n * @param {string} file the file path relative to the app folder\n * @return {string} URL with webroot to a file\n */\nconst linkTo = (app, file) => generateFilePath(app, '', file);\n\n/**\n * Creates a relative url for remote use\n *\n * @param {string} service id\n * @return {string} the url\n */\nexports.linkTo = linkTo;\nconst linkToRemoteBase = service => getRootUrl() + '/remote.php/' + service;\n\n/**\n * @brief Creates an absolute url for remote use\n * @param {string} service id\n * @return {string} the url\n */\nconst generateRemoteUrl = service => window.location.protocol + '//' + window.location.host + linkToRemoteBase(service);\n\n/**\n * Get the base path for the given OCS API service\n *\n * @param {string} url OCS API service url\n * @param {object} params parameters to be replaced into the service url\n * @param {UrlOptions} options options for the parameter replacement\n * @param {boolean} options.escape Set to false if parameters should not be URL encoded (default true)\n * @param {Number} options.ocsVersion OCS version to use (defaults to 2)\n * @return {string} Absolute path for the OCS URL\n */\nexports.generateRemoteUrl = generateRemoteUrl;\nconst generateOcsUrl = (url, params, options) => {\n  const allOptions = Object.assign({\n    ocsVersion: 2\n  }, options || {});\n  const version = allOptions.ocsVersion === 1 ? 1 : 2;\n  return window.location.protocol + '//' + window.location.host + getRootUrl() + '/ocs/v' + version + '.php' + _generateUrlPath(url, params, options);\n};\nexports.generateOcsUrl = generateOcsUrl;\n/**\n * Generate a url path, which can contain parameters\n *\n * Parameters will be URL encoded automatically\n *\n * @param {string} url address (can contain placeholders e.g. /call/{token} would replace {token} with the value of params.token\n * @param {object} params parameters to be replaced into the address\n * @param {UrlOptions} options options for the parameter replacement\n * @return {string} Path part for the given URL\n */\nconst _generateUrlPath = (url, params, options) => {\n  const allOptions = Object.assign({\n    escape: true\n  }, options || {});\n  const _build = function (text, vars) {\n    vars = vars || {};\n    return text.replace(/{([^{}]*)}/g, function (a, b) {\n      var r = vars[b];\n      if (allOptions.escape) {\n        return typeof r === 'string' || typeof r === 'number' ? encodeURIComponent(r.toString()) : encodeURIComponent(a);\n      } else {\n        return typeof r === 'string' || typeof r === 'number' ? r.toString() : a;\n      }\n    });\n  };\n  if (url.charAt(0) !== '/') {\n    url = '/' + url;\n  }\n  return _build(url, params || {});\n};\n\n/**\n * Generate the url with webroot for the given relative url, which can contain parameters\n *\n * Parameters will be URL encoded automatically\n *\n * @param {string} url address (can contain placeholders e.g. /call/{token} would replace {token} with the value of params.token\n * @param {object} params parameters to be replaced into the url\n * @param {UrlOptions} options options for the parameter replacement\n * @param {boolean} options.noRewrite True if you want to force index.php being added\n * @param {boolean} options.escape Set to false if parameters should not be URL encoded (default true)\n * @return {string} URL with webroot for the given relative URL\n */\nconst generateUrl = (url, params, options) => {\n  const allOptions = Object.assign({\n    noRewrite: false\n  }, options || {});\n  if (window?.OC?.config?.modRewriteWorking === true && !allOptions.noRewrite) {\n    return getRootUrl() + _generateUrlPath(url, params, options);\n  }\n  return getRootUrl() + '/index.php' + _generateUrlPath(url, params, options);\n};\n\n/**\n * Get the path with webroot to an image file\n * if no extension is given for the image, it will automatically decide\n * between .png and .svg based on what the browser supports\n *\n * @param {string} app the app id to which the image belongs\n * @param {string} file the name of the image file\n * @return {string}\n */\nexports.generateUrl = generateUrl;\nconst imagePath = (app, file) => {\n  if (file.indexOf('.') === -1) {\n    //if no extension is given, use svg\n    return generateFilePath(app, 'img', file + '.svg');\n  }\n  return generateFilePath(app, 'img', file);\n};\n\n/**\n * Get the url with webroot for a file in an app\n *\n * @param {string} app the id of the app\n * @param {string} type the type of the file to link to (e.g. css,img,ajax.template)\n * @param {string} file the filename\n * @return {string} URL with webroot for a file in an app\n */\nexports.imagePath = imagePath;\nconst generateFilePath = (app, type, file) => {\n  const isCore = window?.OC?.coreApps?.indexOf(app) !== -1;\n  let link = getRootUrl();\n  if (file.substring(file.length - 3) === 'php' && !isCore) {\n    link += '/index.php/apps/' + app;\n    if (file !== 'index.php') {\n      link += '/';\n      if (type) {\n        link += encodeURI(type + '/');\n      }\n      link += file;\n    }\n  } else if (file.substring(file.length - 3) !== 'php' && !isCore) {\n    link = window?.OC?.appswebroots?.[app];\n    if (type) {\n      link += '/' + type + '/';\n    }\n    if (link.substring(link.length - 1) !== '/') {\n      link += '/';\n    }\n    link += file;\n  } else {\n    if ((app === 'settings' || app === 'core' || app === 'search') && type === 'ajax') {\n      link += '/index.php/';\n    } else {\n      link += '/';\n    }\n    if (!isCore) {\n      link += 'apps/';\n    }\n    if (app !== '') {\n      app += '/';\n      link += app;\n    }\n    if (type) {\n      link += type + '/';\n    }\n    link += file;\n  }\n  return link;\n};\n\n/**\n * Return the web root path where this Nextcloud instance\n * is accessible, with a leading slash.\n * For example \"/nextcloud\".\n *\n * @return {string} web root path\n */\nexports.generateFilePath = generateFilePath;\nconst getRootUrl = () => window?.OC?.webroot || '';\nexports.getRootUrl = getRootUrl;\n//# sourceMappingURL=index.js.map","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","const isPublicElmt = document.getElementById('isPublic')\nexport default () => !!(isPublicElmt && isPublicElmt.value === '1')\n","const mimetypeElmt = document.getElementById('mimetype')\nexport default () => mimetypeElmt && mimetypeElmt.value === 'application/x-ownpad'\n","/**\n * Nextcloud - Ownpad\n *\n * This file is licensed under the Affero General Public License\n * version 3 or later. See the COPYING file.\n *\n * @author Olivier Tétard <olivier.tetard@miskin.fr>\n * @copyright Olivier Tétard <olivier.tetard@miskin.fr>, 2023\n */\n\nimport { generateUrl } from '@nextcloud/router'\n\nimport isPublicPage from './utils/isPublicPage.js'\nimport isOwnpad from './utils/isOwnpad.js'\n\nwindow.addEventListener('DOMContentLoaded', function() {\n\t// If we display a folder, we don't have anything more to do here\n\tif (isPublicPage() && !isOwnpad()) {\n\t\treturn\n\t}\n\n\tconst contentElmt = document.getElementById('files-public-content')\n\tconst sharingTokenElmt = document.getElementById('sharingToken')\n\tconst footerElmt = document.querySelector('body > footer') || document.querySelector('#app-content > footer')\n\tconst mainContent = document.querySelector('#content')\n\n\tconst sharingToken = sharingTokenElmt.value\n\tconst viewerUrl = generateUrl('/apps/ownpad/public/{token}', { token: sharingToken })\n\n\t// Create viewer frame\n\tconst viewerNode = document.createElement('iframe')\n\tviewerNode.style.height = '100%'\n\tviewerNode.style.width = '100%'\n\tviewerNode.style.position = 'absolute'\n\n\t// Inject viewer\n\tif (contentElmt) {\n\t\tcontentElmt.innerHTML = ''\n\t\tcontentElmt.appendChild(viewerNode)\n\t\tviewerNode.src = viewerUrl\n\t\tfooterElmt.style.display = 'none'\n\t\tmainContent.style.minHeight = 'calc(100% - var(--header-height))' // Make the viewer take the whole height as the footer is now hidden.\n\t\t// overwrite style in order to fix the viewer on public pages\n\t\tmainContent.style.marginLeft = '0'\n\t\tmainContent.style.marginRight = '0'\n\t\tmainContent.style.width = '100%'\n\t\tmainContent.style.borderRadius = 'unset'\n\t}\n})\n"],"names":["exports","generateUrl","_generateUrlPath","url","params","options","allOptions","Object","assign","escape","charAt","vars","replace","a","b","r","encodeURIComponent","toString","noRewrite","window","OC","config","modRewriteWorking","getRootUrl","generateFilePath","app","type","file","isCore","coreApps","indexOf","link","substring","length","appswebroots","encodeURI","webroot","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","module","__webpack_modules__","isPublicElmt","document","getElementById","mimetypeElmt","addEventListener","value","contentElmt","sharingTokenElmt","footerElmt","querySelector","mainContent","sharingToken","viewerUrl","token","viewerNode","createElement","style","height","width","position","innerHTML","appendChild","src","display","minHeight","marginLeft","marginRight","borderRadius"],"sourceRoot":""}